<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="QGENOME: Quantum Viterbi DNA Decoder" />
  <meta name="theme-color" content="#0a5ec0" />
  <title>QGENOME: Quantum Viterbi DNA Decoder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
</head>
<body>
  <div id="root"></div>
  <!--
    const { useState, useEffect, useRef } = React;
    const API_BASE = 'http://localhost:8000';

    const Metric = ({ label, value, unit = '' }) => (
      <div className="metric-card">
        <div className="metric-title">{label}</div>
        <div className="metric-value">{typeof value === 'number' ? value.toFixed(2) : value} {unit}</div>
      </div>
    );

    function App() {
      const [sequence1, setSequence1] = useState('');
      const [sequence2, setSequence2] = useState('');
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [activeTab, setActiveTab] = useState('quantum');
      const [alignResult, setAlignResult] = useState(null);
      const [motifResult, setMotifResult] = useState(null);
      const [variantResult, setVariantResult] = useState(null);
      const [swResult, setSwResult] = useState(null);
      const [blastResults, setBlastResults] = useState(null);
      const [helixData, setHelixData] = useState(null);
      const [circuitData, setCircuitData] = useState(null);
      const [runs, setRuns] = useState([]);
      const [runsLoading, setRunsLoading] = useState(false);
      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      useEffect(() => {
        const loadSamples = async () => {
          try {
            const res = await fetch(`${API_BASE}/samples`);
            if (res.ok) {
              const data = await res.json();
              setSequence1(data.seq1 || '');
              setSequence2(data.seq2 || '');
            }
          } catch (err) {
            console.log('Sample load error');
          }
        };
        loadSamples();
        fetchRuns();
      }, []);

      const fetchRuns = async () => {
        setRunsLoading(true);
        try {
          const res = await fetch(`${API_BASE}/runs`);
          if (res.ok) setRuns(await res.json());
        } catch (err) {
          console.error('Runs fetch error');
        } finally {
          setRunsLoading(false);
        }
      };

      useEffect(() => {
        if (alignResult?.convergence && chartRef.current) {
          const ctx = chartRef.current.getContext('2d');
          if (chartInstanceRef.current) chartInstanceRef.current.destroy();
          chartInstanceRef.current = new Chart(ctx, {
            type: 'line',
            data: {
              labels: alignResult.convergence.map((_, i) => `Iter ${i}`),
              datasets: [{
                label: 'Energy (VQE)',
                data: alignResult.convergence,
                borderColor: '#0a5ec0',
                backgroundColor: 'rgba(10, 94, 192, 0.1)',
                borderWidth: 2,
                tension: 0.3,
                fill: true
              }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true } }, scales: { y: { beginAtZero: false } } }
          });
        }
      }, [alignResult]);

      const handleAlign = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/align`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sequence_a: sequence1, sequence_b: sequence2 }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          setAlignResult(await res.json());
          fetchRuns();
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleMotif = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/find-motifs`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sequence: sequence1, motif_width: 8 }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          setMotifResult(await res.json());
          fetchRuns();
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleVariant = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/detect-variant`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sequence: sequence1 }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          setVariantResult(await res.json());
          fetchRuns();
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleSmithWaterman = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/smith-waterman`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sequence1, sequence2 }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          setSwResult((await res.json()).results);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleBlastSearch = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/blast-search`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ query: sequence1, subject: sequence2 }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          setBlastResults((await res.json()).results);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleVisualize = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${API_BASE}/visualize`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sequence: sequence1, algorithm: 'vqe' }) });
          if (!res.ok) throw new Error((await res.json()).detail || 'Failed');
          const data = await res.json();
          setHelixData(data.helix);
          setCircuitData(data.circuit);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const exportJSON = () => {
        const data = { timestamp: new Date().toISOString(), sequences: { sequence1, sequence2 }, alignResult, motifResult, variantResult, swResult, blastResults, visualizations: { helixData, circuitData } };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `qgenome-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      return (
        <div>
          <header>
            <h1>üß¨ QGENOME</h1>
            <p>Quantum Viterbi DNA Decoder ‚Ä¢ Real-time Sequence Alignment & Analysis</p>
          </header>
          <div className="container">
            {error && <div className="error-message">‚ùå Error: {error}</div>}
            <div className="grid grid-2">
              <div className="card">
                <label>Sequence 1 (Query)</label>
                <textarea value={sequence1} onChange={e => setSequence1(e.target.value.toUpperCase())} placeholder="Enter DNA sequence (ATGC)..." disabled={loading} />
              </div>
              <div className="card">
                <label>Sequence 2 (Subject)</label>
                <textarea value={sequence2} onChange={e => setSequence2(e.target.value.toUpperCase())} placeholder="Enter DNA sequence (ATGC)..." disabled={loading} />
              </div>
            </div>
            <div className="card">
              <h3>Select Quantum Algorithm</h3>
              <div className="flex">
                <button onClick={handleAlign} disabled={loading || !sequence1 || !sequence2}>{loading ? '‚è≥' : '‚öõÔ∏è'} VQE Alignment</button>
                <button onClick={handleMotif} disabled={loading || !sequence1}>{loading ? '‚è≥' : 'üîç'} QAOA Motif</button>
                <button onClick={handleVariant} disabled={loading || !sequence1}>{loading ? '‚è≥' : 'üß™'} QCNN Variant</button>
              </div>
            </div>
            <div className="tabs">
              <button className={`tab ${activeTab === 'quantum' ? 'active' : ''}`} onClick={() => setActiveTab('quantum')}>‚öõÔ∏è Quantum</button>
              <button className={`tab ${activeTab === 'classical' ? 'active' : ''}`} onClick={() => setActiveTab('classical')}>üî¨ Classical</button>
              <button className={`tab ${activeTab === 'visualizations' ? 'active' : ''}`} onClick={() => setActiveTab('visualizations')}>üìä Viz</button>
              <button className={`tab ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}>üìà History</button>
            </div>

            {activeTab === 'quantum' && (
              <div className="grid">
                {alignResult && (
                  <div className="card">
                    <h3>VQE Alignment Results</h3>
                    <div className="metrics">
                      <Metric label="Score" value={alignResult.alignment_score} unit="%" />
                      <Metric label="Energy" value={alignResult.final_energy} unit="Eh" />
                      <Metric label="Qubits" value={alignResult.qubits} />
                      <Metric label="Iterations" value={alignResult.convergence?.length || 0} />
                    </div>
                    <div style={{ height: '300px', marginTop: '20px' }}><canvas ref={chartRef}></canvas></div>
                  </div>
                )}
                {motifResult && (
                  <div className="card">
                    <h3>QAOA Motif Results</h3>
                    <div className="metrics">
                      <Metric label="Motif" value={motifResult.best_motif} />
                      <Metric label="Score" value={motifResult.score} />
                      <Metric label="IC" value={motifResult.information_content} unit="bits" />
                    </div>
                  </div>
                )}
                {variantResult && (
                  <div className="card">
                    <h3>QCNN Variant Results</h3>
                    <div className="metrics">
                      <Metric label="Prob" value={variantResult.pathogenic_probability} unit="%" />
                      <Metric label="Classification" value={variantResult.classification} />
                    </div>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'classical' && (
              <div className="grid">
                <div className="card algo-card">
                  <h4>Smith-Waterman</h4>
                  <p className="muted">Local alignment</p>
                  <button onClick={handleSmithWaterman} disabled={loading || !sequence1 || !sequence2}>‚ñ∂Ô∏è Run</button>
                  {swResult && <div className="metrics" style={{marginTop:'12px'}}><Metric label="Score" value={swResult.score} /></div>}
                </div>
                <div className="card algo-card">
                  <h4>BLAST Search</h4>
                  <p className="muted">Word-based search</p>
                  <button onClick={handleBlastSearch} disabled={loading || !sequence1 || !sequence2}>‚ñ∂Ô∏è Run</button>
                  {blastResults && <div className="metrics" style={{marginTop:'12px'}}><Metric label="Score" value={blastResults.alignment_score} /></div>}
                </div>
              </div>
            )}

            {activeTab === 'visualizations' && (
              <div className="grid">
                <div className="card">
                  <h3>Visualization Generator</h3>
                  <button onClick={handleVisualize} disabled={loading || !sequence1}>üé® Generate</button>
                </div>
                {helixData && (
                  <div className="card">
                    <h3>3D DNA Helix</h3>
                    <div className="muted">Sequence: {helixData.sequence_length} bp | Turns: {helixData.helical_turn.toFixed(2)}</div>
                    <table className="table" style={{marginTop:'12px'}}>
                      <thead><tr><th>Base</th><th>Pos</th><th>Coord</th><th>Color</th></tr></thead>
                      <tbody>
                        {helixData.bases.slice(0, 10).map((b, i) => (
                          <tr key={i}>
                            <td><span style={{color: b.color, fontWeight:'bold'}}>{b.base}</span></td>
                            <td>{b.index}</td>
                            <td className="muted" style={{fontSize:'11px'}}>({b.position[0].toFixed(2)}, {b.position[1].toFixed(2)}, {b.position[2].toFixed(2)})</td>
                            <td><div style={{width:'16px', height:'16px', background: b.color, borderRadius:'3px'}}></div></td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
                {circuitData && (
                  <div className="card">
                    <h3>Quantum Circuit</h3>
                    <div className="muted">Qubits: {circuitData.num_qubits} | Depth: {circuitData.depth}</div>
                    <table className="table" style={{marginTop:'12px'}}>
                      <thead><tr><th>Gate</th><th>Qubits</th><th>Label</th></tr></thead>
                      <tbody>
                        {circuitData.gates.slice(0, 10).map((g, i) => (
                          <tr key={i}>
                            <td><span className="pill">{g.type}</span></td>
                            <td>[{g.qubits.join(',')}]</td>
                            <td className="muted">{g.label}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'history' && (
              <div className="card">
                <h3>Recent Runs</h3>
                {runsLoading ? <div className="muted">Loading...</div> : (
                  <table className="table">
                    <thead><tr><th>Type</th><th>Score</th><th>Time</th></tr></thead>
                    <tbody>
                      {runs.length === 0 ? <tr><td colSpan="3" className="muted">No runs yet</td></tr> : runs.map(r => (
                        <tr key={r.id}>
                          <td><span className="pill">{r.run_type}</span></td>
                          <td>{r.score?.toFixed(2) || 'N/A'}</td>
                          <td className="muted">{new Date(r.created_at).toLocaleString()}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                )}
              </div>
            )}

            <div className="grid grid-2">
              <div className="card">
                <h3>Export Results</h3>
                <button onClick={exportJSON} disabled={!alignResult && !motifResult && !variantResult}>üì• Download JSON</button>
              </div>
              <div className="card">
                <h3>Information</h3>
                <p className="muted">‚Ä¢ All computations run locally</p>
                <p className="muted">‚Ä¢ No external APIs ‚Ä¢ SQLite persistence</p>
                <p className="muted">‚Ä¢ Supports sequences up to 10,000 bp</p>
              </div>
            </div>
            <footer>üî¨ QGENOME ¬© 2025 ‚Ä¢ Built with React, FastAPI & NumPy</footer>
          </div>
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QGENOME: Quantum Viterbi DNA Decoder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --muted: #7c8895;
      --text: #1b1f27;
      --border: #e8ecf3;
      --accent: #0a5ec0;
      --accent-2: #226ccc;
      --shadow: 0 12px 30px rgba(10, 94, 192, 0.12);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header {
      background: linear-gradient(135deg, #0a5ec0, #0b5aad);
      color: #fff;
      padding: 32px 48px;
      box-shadow: 0 12px 40px rgba(10, 94, 192, 0.2);
    }
    header h1 { margin: 0 0 8px; font-size: 28px; }
    header p { margin: 0; color: rgba(255,255,255,0.85); }
    .container { max-width: 1180px; margin: 0 auto; padding: 32px 24px 64px; }
    .grid { display: grid; gap: 16px; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px 20px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    }
    .card h3 { margin: 0 0 10px; font-size: 16px; font-weight: 600; }
    label { display: block; font-weight: 600; margin-bottom: 6px; color: var(--muted); }
    textarea, input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: 'Inter', monospace;
      resize: vertical;
      min-height: 86px;
      color: var(--text);
      background: #fdfdff;
    }
    .muted { color: var(--muted); font-size: 13px; }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform 0.1s ease, box-shadow 0.2s ease;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(10,94,192,0.18); }
    button:disabled { opacity: 0.55; cursor: not-allowed; box-shadow: none; }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(10,94,192,0.08);
      color: var(--accent);
      border-radius: 30px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap: 12px; }
    .metric-card { background: #f8faff; border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; }
    .metric-title { color: var(--muted); font-size: 12px; }
    .metric-value { font-size: 20px; font-weight: 700; }
    .flex { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .section-title { margin: 8px 0 4px; font-size: 18px; }
    .table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    .table th, .table td { border: 1px solid var(--border); padding: 10px; text-align: left; font-size: 13px; }
    .table th { background: #f5f8ff; }
    .badge { padding: 6px 10px; border-radius: 10px; font-weight: 600; font-size: 12px; }
    .success { background: #e7f5ed; color: #1f7a43; }
    .warning { background: #fff7e6; color: #ad6800; }
    .error { background: #fdecec; color: #d14343; }
    .chart-box { height: 240px; }
    footer { margin-top: 24px; color: var(--muted); font-size: 13px; text-align: center; }
    .tabs { display: flex; gap: 8px; border-bottom: 2px solid var(--border); margin-bottom: 16px; }
    .tab { padding: 10px 16px; cursor: pointer; border: none; background: none; font-weight: 600; color: var(--muted); border-bottom: 3px solid transparent; }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .helix-container { width: 100%; height: 400px; border: 1px solid var(--border); border-radius: 10px; background: #f0f0f0; }
    .algorithm-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 12px; }
    .algo-card { background: #f8faff; border-left: 4px solid var(--accent); padding: 12px; border-radius: 8px; }
    .algo-name { font-weight: 600; color: var(--text); margin-bottom: 4px; }
    .algo-metric { font-size: 12px; color: var(--muted); margin: 4px 0; }
  </style>
</head>
<body>
  <header>
    <h1>QGENOME ‚Äî Quantum Viterbi for DNA Sequences</h1>
    <p>Upload FASTA / plain DNA, pick decoding path, compare classical vs quantum-inspired outputs.</p>
  </header>
  <div class="container" id="app"></div>

  <script type="text/babel">
    const api = window.API_BASE || 'http://localhost:8000';

    function Metric({title, value, suffix}) {
      return (
        <div className="metric-card">
          <div className="metric-title">{title}</div>
          <div className="metric-value">{value}{suffix || ''}</div>
        </div>
      );
    }

    function App() {
      const [sequence1, setSequence1] = React.useState('');
      const [sequence2, setSequence2] = React.useState('');
      const [loading, setLoading] = React.useState(false);
      const [motifResult, setMotifResult] = React.useState(null);
      const [variantResult, setVariantResult] = React.useState(null);
      const [alignResult, setAlignResult] = React.useState(null);
      const [runs, setRuns] = React.useState([]);
      const [runsLoading, setRunsLoading] = React.useState(false);
      const [error, setError] = React.useState('');
      const [alignRuntime, setAlignRuntime] = React.useState(null);
      const chartRef = React.useRef(null);
      const chartObj = React.useRef(null);
      const [loadingSamples, setLoadingSamples] = React.useState(false);
      const [activeTab, setActiveTab] = React.useState("align");
      const [swResult, setSwResult] = React.useState(null);
      const [blastResults, setBlastResults] = React.useState(null);
      const [batchResults, setBatchResults] = React.useState(null);
      const [helixData, setHelixData] = React.useState(null);
      const [circuitData, setCircuitData] = React.useState(null);

      const loadSamples = async () => {
        try {
          setLoadingSamples(true);
          const res = await fetch(`${api}/samples`);
          const data = await res.json();
          if (data.sequence1 && data.sequence2) {
            setSequence1(data.sequence1);
            setSequence2(data.sequence2);
          }
        } catch (err) {
          setError('Unable to load sample data');
        } finally {
          setLoadingSamples(false);
        }
      };

      const fetchRuns = async () => {
        try {
          setRunsLoading(true);
          const res = await fetch(`${api}/runs?limit=8`);
          const data = await res.json();
          setRuns(Array.isArray(data) ? data : []);
        } catch (err) {
          console.error('Failed to load history', err);
        } finally {
          setRunsLoading(false);
        }
      };

      React.useEffect(() => {
        loadSamples();
        fetchRuns();
      }, []);

      const handleAlign = async () => {
        setError(''); setLoading(true);
        const started = performance.now();
        try {
          const res = await fetch(`${api}/align`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequence1, sequence2 })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'Alignment failed');
          const data = await res.json();
          setAlignResult(data.results);
          drawChart(data.results?.convergence || []);
          setAlignRuntime(((performance.now() - started) / 1000).toFixed(2));
          fetchRuns();
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleMotif = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${api}/find-motifs`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequences: [sequence1, sequence2], motif_length: 6 })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'Motif search failed');
          setMotifResult((await res.json()).results);
          fetchRuns();
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleVariant = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${api}/detect-variant`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequence: sequence1 })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'Variant detection failed');
          setVariantResult((await res.json()).results);
          fetchRuns();
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleSmithWaterman = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${api}/smith-waterman`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequence1, sequence2 })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'Smith-Waterman failed');
          setSwResult((await res.json()).results);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleBlastSearch = async () => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${api}/blast-search`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequences: [sequence1, sequence2], motif_length: 11 })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'BLAST search failed');
          setBlastResults((await res.json()).results);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const handleVisualize = async (type) => {
        setError(''); setLoading(true);
        try {
          const res = await fetch(`${api}/visualize`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequence: sequence1, type })
          });
          if (!res.ok) throw new Error((await res.json()).detail || 'Visualization failed');
          const data = await res.json();
          if (type === 'helix') setHelixData(data.data);
          else if (type === 'circuit') setCircuitData(data.data);
        } catch (err) { setError(err.message); }
        finally { setLoading(false); }
      };

      const drawChart = (convergence = []) => {
        if (!chartRef.current) return;
        const ctx = chartRef.current.getContext('2d');
        if (chartObj.current) chartObj.current.destroy();
        chartObj.current = new Chart(ctx, {
          type: 'line',
          data: {
            labels: convergence.map(c => c.iteration),
            datasets: [{
              label: 'Energy',
              data: convergence.map(c => c.energy),
              borderColor: '#0a5ec0',
              backgroundColor: 'rgba(10,94,192,0.12)',
              borderWidth: 2,
              tension: 0.25,
              fill: true
            }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: { x: { title: { display: true, text: 'Iteration' } }, y: { title: { display: true, text: 'Energy' } } }
          }
        });
      };

      const decodedPath = () => {
        if (alignResult && alignResult.alignment_path) return alignResult.alignment_path.split('').join('-');
        if (!alignResult) return 'Run alignment to view path.';
        return 'Path unavailable';
      };

      const exportJSON = () => {
        if (!alignResult) return;
        const blob = new Blob([JSON.stringify({ alignResult, motifResult, variantResult }, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'qgenome_results.json'; a.click();
        URL.revokeObjectURL(url);
      };

      return (
        <div className="grid" style={{gap: '18px'}}>
          <div className="card">
            <div className="flex" style={{justifyContent:'space-between'}}>
              <div>
                <div className="pill">UI Lock: demo_frontend_output matched</div>
                <h2 className="section-title">DNA Upload & Model Selection</h2>
                <p className="muted">Load sequences, pick quantum VQE alignment, motif finding, or QCNN variant detection.</p>
              </div>
              <button onClick={loadSamples} disabled={loadingSamples}>{loadingSamples ? 'Loading‚Ä¶' : 'Use sample data'}</button>
            </div>
            <div className="grid grid-2" style={{marginTop: '12px'}}>
              <div>
                <label>Sequence A</label>
                <textarea value={sequence1} onChange={e => setSequence1(e.target.value.toUpperCase())} />
              </div>
              <div>
                <label>Sequence B</label>
                <textarea value={sequence2} onChange={e => setSequence2(e.target.value.toUpperCase())} />
              </div>
            </div>
            <div className="flex" style={{marginTop:'14px'}}>
              <button disabled={loading} onClick={handleAlign}>{loading ? 'Processing‚Ä¶' : 'Run Quantum VQE Alignment'}</button>
              <button disabled={loading} onClick={handleMotif} style={{background:'#226ccc'}}>Find Motifs (QAOA)</button>
              <button disabled={loading} onClick={handleVariant} style={{background:'#124a9a'}}>Detect Variant (QCNN)</button>
              {error && <span className="badge error">{error}</span>}
            </div>
            <div style={{marginTop:'16px', paddingTop:'16px', borderTop:'1px solid var(--border)'}}>
              <div className="tabs">
                <button className={`tab ${activeTab === 'classical' ? 'active' : ''}`} onClick={() => setActiveTab('classical')}>Classical Algorithms</button>
                <button className={`tab ${activeTab === 'viz' ? 'active' : ''}`} onClick={() => setActiveTab('viz')}>Visualizations</button>
              </div>
              {activeTab === 'classical' && (
                <div style={{marginTop:'12px'}}>
                  <button onClick={handleSmithWaterman} disabled={loading} style={{marginRight:'8px'}}>Smith-Waterman Align</button>
                  <button onClick={handleBlastSearch} disabled={loading} style={{marginRight:'8px', background:'#ff9800'}}>BLAST-like Search</button>
                </div>
              )}
              {activeTab === 'viz' && (
                <div style={{marginTop:'12px'}}>
                  <button onClick={() => handleVisualize('helix')} disabled={loading} style={{marginRight:'8px'}}>3D DNA Helix</button>
                  <button onClick={() => handleVisualize('circuit')} disabled={loading} style={{background:'#9c27b0'}}>Quantum Circuit</button>
                </div>
              )}
            </div>
          </div>

          <div className="grid grid-2">
            <div className="card">
              <h3>Alignment Metrics</h3>
              <div className="metrics">
                <Metric title="Alignment Score" value={alignResult ? alignResult.alignment_score.toFixed(2) : '‚Äî'} suffix=" / 100" />
                <Metric title="Final Energy" value={alignResult ? alignResult.final_energy.toFixed(3) : '‚Äî'} />
                <Metric title="Qubits" value={alignResult ? alignResult.qubits : '‚Äî'} />
                <Metric title="Iterations" value={alignResult ? alignResult.convergence.length : '0'} />
              </div>
              <div className="chart-box" style={{marginTop:'12px'}}>
                <canvas ref={chartRef}></canvas>
              </div>
            </div>

            <div className="card">
              <h3>Motif & Variant Outputs</h3>
              <div className="grid" style={{gap:'10px'}}>
                <div className="metric-card">
                  <div className="metric-title">Motif</div>
                  <div className="metric-value">{motifResult ? motifResult.motif : '‚Äî'}</div>
                  <div className="muted">Pos: {motifResult && motifResult.positions ? `Seq ${motifResult.positions.sequence_index + 1} @ ${motifResult.positions.start}` : '‚Äî'}</div>
                  <div className="muted">IC/Score: {motifResult ? motifResult.information_content.toFixed(2) : '‚Äî'} / {motifResult ? motifResult.score.toFixed(2) : '‚Äî'}</div>
                </div>
                <div className="metric-card">
                  <div className="metric-title">Variant Detection</div>
                  <div className="metric-value">{variantResult ? variantResult.classification : '‚Äî'}</div>
                  <div className="muted">Probability: {variantResult ? variantResult.pathogenic_probability.toFixed(2) : '‚Äî'}</div>
                  {variantResult && variantResult.features && <div className="muted">GC: {variantResult.features.gc_content.toFixed(2)} ‚Ä¢ Entropy: {variantResult.features.kmer_entropy.toFixed(2)}</div>}
                </div>
              </div>
            </div>
          </div>

          <div className="card">
            <h3>Decoded Path Visualization</h3>
            <div className="pill" style={{background:'rgba(33,150,83,0.1)', color:'#218c4a'}}>E = Exon (match)</div>
            <div className="pill" style={{background:'rgba(219,68,55,0.1)', color:'#d13b2f'}}>I = Intron (mismatch)</div>
            <div className="muted" style={{marginTop:'8px'}}>{decodedPath()}</div>
          </div>

          <div className="card">
            <h3>Performance Metrics Dashboard</h3>
            <table className="table">
              <thead>
                <tr>
                  <th>Metric</th><th>Value</th><th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>Runtime</td><td><span className="badge success">{alignRuntime ? `${alignRuntime}s` : '‚Äî'}</span></td><td>Wall-clock from API</td></tr>
                <tr><td>Sequence Length</td><td>{alignResult ? alignResult.aligned_sequence1.replace(/-/g,'').length : Math.max(sequence1.length, sequence2.length)} bp</td><td>Validated ‚â§ 500 bp</td></tr>
                <tr><td>Qubits Used</td><td>{alignResult ? alignResult.qubits : '‚Äî'}</td><td>PhysioQ 3 qubits/base</td></tr>
                <tr><td>Accuracy Target</td><td>‚â• 85%</td><td>Compare against classical baseline</td></tr>
              </tbody>
            </table>
          </div>

          <div className="card">
            <h3>Classical Algorithm Comparison</h3>
            <div className="algorithm-comparison">
              {swResult && (
                <div className="algo-card">
                  <div className="algo-name">Smith-Waterman</div>
                  <div className="algo-metric">Score: {swResult.score.toFixed(2)}</div>
                  <div className="algo-metric">Positions: {swResult.start_position}</div>
                  <div className="algo-metric">Path: {swResult.alignment_path.substring(0, 20)}...</div>
                </div>
              )}
              {blastResults && blastResults.length > 0 && (
                <div className="algo-card">
                  <div className="algo-name">BLAST-like Search</div>
                  <div className="algo-metric">Top hit: {blastResults[0].alignment_score.toFixed(2)}</div>
                  <div className="algo-metric">E-value: {blastResults[0].evalue.toExponential(2)}</div>
                  <div className="algo-metric">Matches: {blastResults.length} hits</div>
                </div>
              )}
            </div>
          </div>

          <div className="card">
            <h3>Advanced Visualizations</h3>
            {helixData && (
              <div>
                <h4>3D DNA Helix Structure</h4>
                <div className="muted">Sequence: {helixData.sequence_length} bp | Turns: {helixData.helical_turn.toFixed(2)}</div>
                <table className="table" style={{marginTop:'12px'}}>
                  <thead><tr><th>Base</th><th>Position</th><th>Coordinates</th><th>Color</th></tr></thead>
                  <tbody>
                    {helixData.bases.slice(0, 10).map((b, i) => (
                      <tr key={i}>
                        <td><span style={{color: b.color, fontWeight:'bold'}}>{b.base}</span></td>
                        <td>{b.index}</td>
                        <td>({b.position[0].toFixed(2)}, {b.position[1].toFixed(2)}, {b.position[2].toFixed(2)})</td>
                        <td><div style={{width:'20px', height:'20px', background: b.color, borderRadius:'4px'}}></div></td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                <div className="muted">Showing first 10 bases...</div>
              </div>
            )}
            {circuitData && (
              <div>
                <h4>Quantum Circuit: {circuitData.algorithm.toUpperCase()}</h4>
                <div className="muted">Qubits: {circuitData.num_qubits} | Depth: {circuitData.depth} | Length: {circuitData.sequence_length}</div>
                <table className="table" style={{marginTop:'12px'}}>
                  <thead><tr><th>Gate Type</th><th>Qubits</th><th>Label</th></tr></thead>
                  <tbody>
                    {circuitData.gates.map((g, i) => (
                      <tr key={i}>
                        <td><span className="pill">{g.type}</span></td>
                        <td>{g.qubits.join(', ')}</td>
                        <td>{g.label}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>

          <div className="card">
            <h3>Recent Runs (DB-backed)</h3>
            {runsLoading && <div className="muted">Loading history‚Ä¶</div>}
            <table className="table">
              <thead><tr><th>Type</th><th>Score</th><th>Created</th></tr></thead>
              <tbody>
                {runs.length === 0 && <tr><td colSpan="3">No runs yet</td></tr>}
                {runs.map(r => (
                  <tr key={r.id}>
                    <td>{r.run_type}</td>
                    <td>{r.score.toFixed ? r.score.toFixed(2) : r.score}</td>
                    <td>{new Date(r.created_at).toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div className="card">
            <h3>Result Export Panel</h3>
            <div className="flex">
              <button onClick={exportJSON} disabled={!alignResult}>Download JSON</button>
              <span className="muted">Exports alignment, motif, and variant outputs.</span>
            </div>
          </div>

          <div className="card">
            <h3>Error Handling Example</h3>
            <p className="muted">Invalid bases or oversize input will be blocked with friendly errors.</p>
            <div className="badge warning">Try entering digits or N to see validation.</div>
          </div>

          <footer>
            QGENOME UI cloned from demo_frontend_output ‚Ä¢ All logic local, no paid services ‚Ä¢ Built for student-grade hardware.
          </footer>
        </div>
      );
    }

  -->
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>
